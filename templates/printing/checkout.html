{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Inbum | Preview</title>
    <!-- Bootstrap 5 CSS -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
            crossorigin="anonymous"
    />

    <!-- Demo CSS (No need to include it into your project) -->
    <link rel="stylesheet" href="{% static "css/preview.css" %}"/>
</head>
<body>
<main class="bg-black text-white">
    <!-- DEMO HTML -->
    <div class="container pb-5">
        <div class="py-5 text-center">
            <h2 class="header">Preview & Checkout</h2>
        </div>
        <div class="row">
            <div class="col-md-4 order-md-2 mb-4    ">
                <ul class="list-group mb-3">
                    <!-- 3d preview  -->
                    <div style="height: 500px;background-color: rgb(163, 173, 184);" 
                        class="stlviewer list-group-item d-flex justify-content-between lh-condensed" 
                        data-src="{{ object.file.url }}">
                    </div>
                    <!-- end 3d preview  -->
                    <li
                            class="list-group-item d-flex justify-content-between lh-condensed bg-dark text-white"
                    >
                        <div>
                            <h6 class="my-0">Quantity</h6>
                        </div>
                        <span>+</span>
                        <span>0</span>
                        <span>+</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between bg-dark text-white">
                        <span>Total (INR)</span>
                        <strong>â‚¹ 2000</strong>
                    </li>
                </ul>
            </div>


            <div class="col-md-8 order-md-1">
                <h4 class="mb-3">Billing address</h4>
                <form class="needs-validation" action="" method="post">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="firstName">First name</label>
                            <input
                                    type="text"
                                    class="form-control"    
                                    id="firstName"
                                    placeholder=""
                                    value=""
                                    required
                                    name="first_name"
                            />
                            <div class="invalid-feedback">
                                Valid first name is required.
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="lastName">Last name</label>
                            <input
                                    type="text"
                                    class="form-control"
                                    id="lastName"
                                    placeholder=""
                                    value=""
                                    required
                                    name="last_name"

                            />
                            <div class="invalid-feedback">
                                Valid last name is required.
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="mb-3 col-md-6">
                            <label for="email"
                            >Email</label
                            >
                            <input
                                    type="email"
                                    class="form-control"
                                    id="email"
                                    placeholder="you@example.com"
                                    name="email"
                            />
                            <div class="invalid-feedback">
                                Please enter a valid email address for shipping updates.
                            </div>
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="phone_number"
                            >Phone number</label
                            >
                            <input
                                    type="tel"
                                    class="form-control"
                                    id="phone_number"
                                    name="phone_number"
                            />
                            <div class="invalid-feedback">
                                Please enter phone_number for shipping updates.
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="address">Address</label>
                        <input
                                type="text"
                                class="form-control"
                                id="address"
                                placeholder="1234 Main St"
                                required
                                name="address_line_1"
                        />
                        <div class="invalid-feedback">
                            Please enter your shipping address.
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="address2"
                        >Address 2 <span class="text-muted">(Optional)</span></label
                        >
                        <input
                                type="text"
                                class="form-control"
                                id="address2"
                                placeholder="Apartment or suite"
                                name="address_line_2"
                        />
                    </div>

                    <div class="row">
                        <div class="col-md-5 mb-3">
                            <label for="country">Country</label>
                            <select
                                    class="form-select d-block w-100"
                                    id="country"
                                    required
                                    name="country"
                            >
                                <option value="">Choose...</option>
                                {% for country in countries %}
                                    <option value="{{ country }}">{{ country }}</option>
                                {% endfor %}
                            </select>
                            <div class="invalid-feedback">
                                Please select a valid country.
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="state">State</label>
                            <select
                                    class="form-select d-block w-100"
                                    id="state"
                                    required
                                    name="state"
                            >
                                <option value="">Choose...</option>
                            </select>
                            <div class="invalid-feedback">
                                Please provide a valid state.
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="zip">Zip</label>
                            <input
                                    type="text"
                                    class="form-control"
                                    id="zip"
                                    placeholder=""
                                    required
                                    name="zip_code"
                            />
                            <div class="invalid-feedback">Zip code required.</div>
                        </div>
                    </div>
                    <hr class="mb-4"/>
                    <div class="custom-control custom-checkbox">
                        <input
                                type="checkbox"
                                class="custom-control-input"
                                id="same-address"

                        />
                        <label class="custom-control-label" for="same-address"
                        >Shipping address is the same as my billing address</label
                        >
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input
                                type="checkbox"
                                class="custom-control-input"
                                id="save-info"
                        />
                        <label class="custom-control-label" for="save-info"
                        >Save this information for next time</label
                        >
                    </div>
                    <hr class="mb-4"/>
                    <button style="background-color: #00ffda; color: black;" class="btn btn-primary btn-lg btn-block" type="submit">
                        Continue to checkout
                    </button>
                </form>
            </div>
        </div>
    </div>
    <!-- End Demo HTML -->
</main>


<script>

    const countrySelect = document.querySelector('#country');
    const stateSelect = document.querySelector('#state');

    countrySelect.addEventListener('change', async (event) => {
        const country = event.target.value;
        const url = `https://countriesnow.space/api/v0.1/countries/states`;
        stateSelect.innerHTML = '<option value="">Loading...</option>';
        await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ country: country }),
        })
        .then((res) => res.json())
        .then((data) => {
            stateSelect.innerHTML = '';
            stateSelect.innerHTML = '<option value="">Choose...</option>';
            data.data.states.forEach((state) => {
                const option = document.createElement('option');
                option.setAttribute('value', state.name);
                option.textContent = state.name;
                stateSelect.appendChild(option);
            });
        });
    });

    function showPreview(event) {
        if (event.target.files.length > 0) {
            var src = URL.createObjectURL(event.target.files[0]);
            var preview = document.getElementById("3d");
            let block = `<div class="stlviewer" data-src="${src}"></div>`;
            preview.innerHTML = block;
        }
    }
</script>


<script src="{% static "js/3js/three.min.js" %}  "></script>
<script src="{% static "js/3js/WebGL.js" %}  "></script>
<script src="{% static "js/3js/STLLoader.js" %} "></script>
<script src="{% static "js/3js/OrbitControls.js" %}  "></script>
<script src="{% static "js/3js/stlviewer.js" %}  "></script>

<script type=text/javascript>
    window.onload = function () {
        STLViewerEnable("stlviewer");
    }
</script>


<!-- Bootstrap 5 JavaScript Bundle with Popper -->
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
        crossorigin="anonymous"
></script>
</body>
</html>
